import{c as Mi,a as bi,R as Pi,i as _t,b as _e,e as pe,f as Di,g as ot,h as H,k as Yt,n as jt,o as et,p as it,q as Nt,v as Xt,w as Jt,x as Qt,y as Gi,z as ke,A as vi,B as V,C as tt,D as lt,E as Rt,F as Ht,G as oi,I as Ai,J as It,K as Wi,L as Vt,N as Bi,Q as Ee,S as gt,U as Je,W as Yi,X as Ct,Y as ji,Z as He,_ as Tt,$ as Zt,a0 as Ni,a1 as xe,a2 as ri,a3 as Xi,a4 as Ji,a5 as Hi,a6 as Ve,a7 as wt,a8 as Vi,a9 as Dt,aa as Gt,ab as Ze,ac as Zi,ad as Ki,ae as Ui,af as zi,ag as Ke,ah as qi,ai as vt,aj as $i,ak as Qi,al as Ue,am as ts,an as es,ao as is,ap as ss,aq as ns,ar as os,as as rs,at as as,au as kt,av as ls,aw as hs,ax as cs,ay as rt,az as ds,aA as W,aB as us,aC as te,aD as ct,aE as fs,aF as gs,aG as _s,aH as ps,aI as xs,aJ as ai,aK as ms,aL as ys,aM as Ss,aN as Cs,aO as ws,aP as Rs,aQ as me,aR as Is,aS as Ts,aT as ks,aU as Es,aV as Ls,aW as Fs,aX as ze,aY as Os,aZ as Ms,a_ as bs,a$ as ye,b0 as Ps,b1 as Ds,b2 as Gs,H as li,j as vs,b3 as ee,b4 as ie,b5 as se,b6 as hi,b7 as As,b8 as Ws,b9 as Bs,u as Ys,M as js,T as Ns,O as Xs,V as Js,d as Hs}from"./index-7546267e.js";/* empty css               */const Et={BEGIN_GEOMETRY:0,BEGIN_PATH:1,CIRCLE:2,CLOSE_PATH:3,CUSTOM:4,DRAW_CHARS:5,DRAW_IMAGE:6,END_GEOMETRY:7,FILL:8,MOVE_TO_LINE_TO:9,SET_FILL_STYLE:10,SET_STROKE_STYLE:11,STROKE:12},At=[Et.FILL],at=[Et.STROKE],ht=[Et.BEGIN_PATH],qe=[Et.CLOSE_PATH],I=Et;class Vs{drawCustom(t,e,i,s){}drawGeometry(t){}setStyle(t){}drawCircle(t,e){}drawFeature(t,e){}drawGeometryCollection(t,e){}drawLineString(t,e){}drawMultiLineString(t,e){}drawMultiPoint(t,e){}drawMultiPolygon(t,e){}drawPoint(t,e){}drawPolygon(t,e){}drawText(t,e){}setFillStrokeStyle(t,e){}setImageStyle(t,e){}setTextStyle(t,e){}}const ci=Vs;class Zs extends ci{constructor(t,e,i,s){super(),this.tolerance=t,this.maxExtent=e,this.pixelRatio=s,this.maxLineWidth=0,this.resolution=i,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_=null,this.bufferedMaxExtent_=null,this.instructions=[],this.coordinates=[],this.tmpCoordinate_=[],this.hitDetectionInstructions=[],this.state={}}applyPixelRatio(t){const e=this.pixelRatio;return e==1?t:t.map(function(i){return i*e})}appendFlatPointCoordinates(t,e){const i=this.getBufferedMaxExtent(),s=this.tmpCoordinate_,n=this.coordinates;let o=n.length;for(let r=0,a=t.length;r<a;r+=e)s[0]=t[r],s[1]=t[r+1],Mi(i,s)&&(n[o++]=s[0],n[o++]=s[1]);return o}appendFlatLineCoordinates(t,e,i,s,n,o){const r=this.coordinates;let a=r.length;const h=this.getBufferedMaxExtent();o&&(e+=s);let c=t[e],u=t[e+1];const d=this.tmpCoordinate_;let f=!0,g,_,x;for(g=e+s;g<i;g+=s)d[0]=t[g],d[1]=t[g+1],x=bi(h,d),x!==_?(f&&(r[a++]=c,r[a++]=u,f=!1),r[a++]=d[0],r[a++]=d[1]):x===Pi.INTERSECTING?(r[a++]=d[0],r[a++]=d[1],f=!1):f=!0,c=d[0],u=d[1],_=x;return(n&&f||g===e+s)&&(r[a++]=c,r[a++]=u),a}drawCustomCoordinates_(t,e,i,s,n){for(let o=0,r=i.length;o<r;++o){const a=i[o],h=this.appendFlatLineCoordinates(t,e,a,s,!1,!1);n.push(h),e=a}return e}drawCustom(t,e,i,s){this.beginGeometry(t,e);const n=t.getType(),o=t.getStride(),r=this.coordinates.length;let a,h,c,u,d;switch(n){case"MultiPolygon":a=t.getOrientedFlatCoordinates(),u=[];const f=t.getEndss();d=0;for(let g=0,_=f.length;g<_;++g){const x=[];d=this.drawCustomCoordinates_(a,d,f[g],o,x),u.push(x)}this.instructions.push([I.CUSTOM,r,u,t,i,pe]),this.hitDetectionInstructions.push([I.CUSTOM,r,u,t,s||i,pe]);break;case"Polygon":case"MultiLineString":c=[],a=n=="Polygon"?t.getOrientedFlatCoordinates():t.getFlatCoordinates(),d=this.drawCustomCoordinates_(a,0,t.getEnds(),o,c),this.instructions.push([I.CUSTOM,r,c,t,i,_e]),this.hitDetectionInstructions.push([I.CUSTOM,r,c,t,s||i,_e]);break;case"LineString":case"Circle":a=t.getFlatCoordinates(),h=this.appendFlatLineCoordinates(a,0,a.length,o,!1,!1),this.instructions.push([I.CUSTOM,r,h,t,i,_t]),this.hitDetectionInstructions.push([I.CUSTOM,r,h,t,s||i,_t]);break;case"MultiPoint":a=t.getFlatCoordinates(),h=this.appendFlatPointCoordinates(a,o),h>r&&(this.instructions.push([I.CUSTOM,r,h,t,i,_t]),this.hitDetectionInstructions.push([I.CUSTOM,r,h,t,s||i,_t]));break;case"Point":a=t.getFlatCoordinates(),this.coordinates.push(a[0],a[1]),h=this.coordinates.length,this.instructions.push([I.CUSTOM,r,h,t,i]),this.hitDetectionInstructions.push([I.CUSTOM,r,h,t,s||i]);break}this.endGeometry(e)}beginGeometry(t,e){this.beginGeometryInstruction1_=[I.BEGIN_GEOMETRY,e,0,t],this.instructions.push(this.beginGeometryInstruction1_),this.beginGeometryInstruction2_=[I.BEGIN_GEOMETRY,e,0,t],this.hitDetectionInstructions.push(this.beginGeometryInstruction2_)}finish(){return{instructions:this.instructions,hitDetectionInstructions:this.hitDetectionInstructions,coordinates:this.coordinates}}reverseHitDetectionInstructions(){const t=this.hitDetectionInstructions;t.reverse();let e;const i=t.length;let s,n,o=-1;for(e=0;e<i;++e)s=t[e],n=s[0],n==I.END_GEOMETRY?o=e:n==I.BEGIN_GEOMETRY&&(s[2]=e,Di(this.hitDetectionInstructions,o,e),o=-1)}setFillStrokeStyle(t,e){const i=this.state;if(t){const s=t.getColor();i.fillStyle=ot(s||H)}else i.fillStyle=void 0;if(e){const s=e.getColor();i.strokeStyle=ot(s||Yt);const n=e.getLineCap();i.lineCap=n!==void 0?n:jt;const o=e.getLineDash();i.lineDash=o?o.slice():et;const r=e.getLineDashOffset();i.lineDashOffset=r||it;const a=e.getLineJoin();i.lineJoin=a!==void 0?a:Nt;const h=e.getWidth();i.lineWidth=h!==void 0?h:Xt;const c=e.getMiterLimit();i.miterLimit=c!==void 0?c:Jt,i.lineWidth>this.maxLineWidth&&(this.maxLineWidth=i.lineWidth,this.bufferedMaxExtent_=null)}else i.strokeStyle=void 0,i.lineCap=void 0,i.lineDash=null,i.lineDashOffset=void 0,i.lineJoin=void 0,i.lineWidth=void 0,i.miterLimit=void 0}createFill(t){const e=t.fillStyle,i=[I.SET_FILL_STYLE,e];return typeof e!="string"&&i.push(!0),i}applyStroke(t){this.instructions.push(this.createStroke(t))}createStroke(t){return[I.SET_STROKE_STYLE,t.strokeStyle,t.lineWidth*this.pixelRatio,t.lineCap,t.lineJoin,t.miterLimit,this.applyPixelRatio(t.lineDash),t.lineDashOffset*this.pixelRatio]}updateFillStyle(t,e){const i=t.fillStyle;(typeof i!="string"||t.currentFillStyle!=i)&&(i!==void 0&&this.instructions.push(e.call(this,t)),t.currentFillStyle=i)}updateStrokeStyle(t,e){const i=t.strokeStyle,s=t.lineCap,n=t.lineDash,o=t.lineDashOffset,r=t.lineJoin,a=t.lineWidth,h=t.miterLimit;(t.currentStrokeStyle!=i||t.currentLineCap!=s||n!=t.currentLineDash&&!Qt(t.currentLineDash,n)||t.currentLineDashOffset!=o||t.currentLineJoin!=r||t.currentLineWidth!=a||t.currentMiterLimit!=h)&&(i!==void 0&&e.call(this,t),t.currentStrokeStyle=i,t.currentLineCap=s,t.currentLineDash=n,t.currentLineDashOffset=o,t.currentLineJoin=r,t.currentLineWidth=a,t.currentMiterLimit=h)}endGeometry(t){this.beginGeometryInstruction1_[2]=this.instructions.length,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_[2]=this.hitDetectionInstructions.length,this.beginGeometryInstruction2_=null;const e=[I.END_GEOMETRY,t];this.instructions.push(e),this.hitDetectionInstructions.push(e)}getBufferedMaxExtent(){if(!this.bufferedMaxExtent_&&(this.bufferedMaxExtent_=Gi(this.maxExtent),this.maxLineWidth>0)){const t=this.resolution*(this.maxLineWidth+1)/2;ke(this.bufferedMaxExtent_,t,this.bufferedMaxExtent_)}return this.bufferedMaxExtent_}}const Lt=Zs;class Ks extends Lt{constructor(t,e,i,s){super(t,e,i,s),this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.anchorX_=void 0,this.anchorY_=void 0,this.height_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.scale_=void 0,this.width_=void 0,this.declutterMode_=void 0,this.declutterImageWithText_=void 0}drawPoint(t,e){if(!this.image_)return;this.beginGeometry(t,e);const i=t.getFlatCoordinates(),s=t.getStride(),n=this.coordinates.length,o=this.appendFlatPointCoordinates(i,s);this.instructions.push([I.DRAW_IMAGE,n,o,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([I.DRAW_IMAGE,n,o,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(e)}drawMultiPoint(t,e){if(!this.image_)return;this.beginGeometry(t,e);const i=t.getFlatCoordinates(),s=t.getStride(),n=this.coordinates.length,o=this.appendFlatPointCoordinates(i,s);this.instructions.push([I.DRAW_IMAGE,n,o,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([I.DRAW_IMAGE,n,o,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(e)}finish(){return this.reverseHitDetectionInstructions(),this.anchorX_=void 0,this.anchorY_=void 0,this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.height_=void 0,this.scale_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.width_=void 0,super.finish()}setImageStyle(t,e){const i=t.getAnchor(),s=t.getSize(),n=t.getOrigin();this.imagePixelRatio_=t.getPixelRatio(this.pixelRatio),this.anchorX_=i[0],this.anchorY_=i[1],this.hitDetectionImage_=t.getHitDetectionImage(),this.image_=t.getImage(this.pixelRatio),this.height_=s[1],this.opacity_=t.getOpacity(),this.originX_=n[0],this.originY_=n[1],this.rotateWithView_=t.getRotateWithView(),this.rotation_=t.getRotation(),this.scale_=t.getScaleArray(),this.width_=s[0],this.declutterMode_=t.getDeclutterMode(),this.declutterImageWithText_=e}}const Us=Ks;class zs extends Lt{constructor(t,e,i,s){super(t,e,i,s)}drawFlatCoordinates_(t,e,i,s){const n=this.coordinates.length,o=this.appendFlatLineCoordinates(t,e,i,s,!1,!1),r=[I.MOVE_TO_LINE_TO,n,o];return this.instructions.push(r),this.hitDetectionInstructions.push(r),i}drawLineString(t,e){const i=this.state,s=i.strokeStyle,n=i.lineWidth;if(s===void 0||n===void 0)return;this.updateStrokeStyle(i,this.applyStroke),this.beginGeometry(t,e),this.hitDetectionInstructions.push([I.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,et,it],ht);const o=t.getFlatCoordinates(),r=t.getStride();this.drawFlatCoordinates_(o,0,o.length,r),this.hitDetectionInstructions.push(at),this.endGeometry(e)}drawMultiLineString(t,e){const i=this.state,s=i.strokeStyle,n=i.lineWidth;if(s===void 0||n===void 0)return;this.updateStrokeStyle(i,this.applyStroke),this.beginGeometry(t,e),this.hitDetectionInstructions.push([I.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,et,it],ht);const o=t.getEnds(),r=t.getFlatCoordinates(),a=t.getStride();let h=0;for(let c=0,u=o.length;c<u;++c)h=this.drawFlatCoordinates_(r,h,o[c],a);this.hitDetectionInstructions.push(at),this.endGeometry(e)}finish(){const t=this.state;return t.lastStroke!=null&&t.lastStroke!=this.coordinates.length&&this.instructions.push(at),this.reverseHitDetectionInstructions(),this.state=null,super.finish()}applyStroke(t){t.lastStroke!=null&&t.lastStroke!=this.coordinates.length&&(this.instructions.push(at),t.lastStroke=this.coordinates.length),t.lastStroke=0,super.applyStroke(t),this.instructions.push(ht)}}const qs=zs;class $s extends Lt{constructor(t,e,i,s){super(t,e,i,s)}drawFlatCoordinatess_(t,e,i,s){const n=this.state,o=n.fillStyle!==void 0,r=n.strokeStyle!==void 0,a=i.length;this.instructions.push(ht),this.hitDetectionInstructions.push(ht);for(let h=0;h<a;++h){const c=i[h],u=this.coordinates.length,d=this.appendFlatLineCoordinates(t,e,c,s,!0,!r),f=[I.MOVE_TO_LINE_TO,u,d];this.instructions.push(f),this.hitDetectionInstructions.push(f),r&&(this.instructions.push(qe),this.hitDetectionInstructions.push(qe)),e=c}return o&&(this.instructions.push(At),this.hitDetectionInstructions.push(At)),r&&(this.instructions.push(at),this.hitDetectionInstructions.push(at)),e}drawCircle(t,e){const i=this.state,s=i.fillStyle,n=i.strokeStyle;if(s===void 0&&n===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(t,e),i.fillStyle!==void 0&&this.hitDetectionInstructions.push([I.SET_FILL_STYLE,H]),i.strokeStyle!==void 0&&this.hitDetectionInstructions.push([I.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,et,it]);const o=t.getFlatCoordinates(),r=t.getStride(),a=this.coordinates.length;this.appendFlatLineCoordinates(o,0,o.length,r,!1,!1);const h=[I.CIRCLE,a];this.instructions.push(ht,h),this.hitDetectionInstructions.push(ht,h),i.fillStyle!==void 0&&(this.instructions.push(At),this.hitDetectionInstructions.push(At)),i.strokeStyle!==void 0&&(this.instructions.push(at),this.hitDetectionInstructions.push(at)),this.endGeometry(e)}drawPolygon(t,e){const i=this.state,s=i.fillStyle,n=i.strokeStyle;if(s===void 0&&n===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(t,e),i.fillStyle!==void 0&&this.hitDetectionInstructions.push([I.SET_FILL_STYLE,H]),i.strokeStyle!==void 0&&this.hitDetectionInstructions.push([I.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,et,it]);const o=t.getEnds(),r=t.getOrientedFlatCoordinates(),a=t.getStride();this.drawFlatCoordinatess_(r,0,o,a),this.endGeometry(e)}drawMultiPolygon(t,e){const i=this.state,s=i.fillStyle,n=i.strokeStyle;if(s===void 0&&n===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(t,e),i.fillStyle!==void 0&&this.hitDetectionInstructions.push([I.SET_FILL_STYLE,H]),i.strokeStyle!==void 0&&this.hitDetectionInstructions.push([I.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,et,it]);const o=t.getEndss(),r=t.getOrientedFlatCoordinates(),a=t.getStride();let h=0;for(let c=0,u=o.length;c<u;++c)h=this.drawFlatCoordinatess_(r,h,o[c],a);this.endGeometry(e)}finish(){this.reverseHitDetectionInstructions(),this.state=null;const t=this.tolerance;if(t!==0){const e=this.coordinates;for(let i=0,s=e.length;i<s;++i)e[i]=vi(e[i],t)}return super.finish()}setFillStrokeStyles_(){const t=this.state;t.fillStyle!==void 0&&this.updateFillStyle(t,this.createFill),t.strokeStyle!==void 0&&this.updateStrokeStyle(t,this.applyStroke)}}const $e=$s;function Qs(l,t,e,i,s){const n=[];let o=e,r=0,a=t.slice(e,2);for(;r<l&&o+s<i;){const[h,c]=a.slice(-2),u=t[o+s],d=t[o+s+1],f=Math.sqrt((u-h)*(u-h)+(d-c)*(d-c));if(r+=f,r>=l){const g=(l-r+f)/f,_=V(h,u,g),x=V(c,d,g);a.push(_,x),n.push(a),a=[_,x],r==l&&(o+=s),r=0}else if(r<l)a.push(t[o+s],t[o+s+1]),o+=s;else{const g=f-r,_=V(h,u,g/f),x=V(c,d,g/f);a.push(_,x),n.push(a),a=[_,x],r=0,o+=s}}return r>0&&n.push(a),n}function tn(l,t,e,i,s){let n=e,o=e,r=0,a=0,h=e,c,u,d,f,g,_,x,p,y,S;for(u=e;u<i;u+=s){const C=t[u],w=t[u+1];g!==void 0&&(y=C-g,S=w-_,f=Math.sqrt(y*y+S*S),x!==void 0&&(a+=d,c=Math.acos((x*y+p*S)/(d*f)),c>l&&(a>r&&(r=a,n=h,o=u),a=0,h=u-s)),d=f,x=y,p=S),g=C,_=w}return a+=f,a>r?[h,u]:[n,o]}const Kt={left:0,center:.5,right:1,top:0,middle:.5,hanging:.2,alphabetic:.8,ideographic:.8,bottom:1};class en extends Lt{constructor(t,e,i,s){super(t,e,i,s),this.labels_=null,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=void 0,this.textRotation_=0,this.textFillState_=null,this.fillStates={},this.fillStates[H]={fillStyle:H},this.textStrokeState_=null,this.strokeStates={},this.textState_={},this.textStates={},this.textKey_="",this.fillKey_="",this.strokeKey_="",this.declutterImageWithText_=void 0}finish(){const t=super.finish();return t.textStates=this.textStates,t.fillStates=this.fillStates,t.strokeStates=this.strokeStates,t}drawText(t,e){const i=this.textFillState_,s=this.textStrokeState_,n=this.textState_;if(this.text_===""||!n||!i&&!s)return;const o=this.coordinates;let r=o.length;const a=t.getType();let h=null,c=t.getStride();if(n.placement==="line"&&(a=="LineString"||a=="MultiLineString"||a=="Polygon"||a=="MultiPolygon")){if(!tt(this.getBufferedMaxExtent(),t.getExtent()))return;let u;if(h=t.getFlatCoordinates(),a=="LineString")u=[h.length];else if(a=="MultiLineString")u=t.getEnds();else if(a=="Polygon")u=t.getEnds().slice(0,1);else if(a=="MultiPolygon"){const _=t.getEndss();u=[];for(let x=0,p=_.length;x<p;++x)u.push(_[x][0])}this.beginGeometry(t,e);const d=n.repeat,f=d?void 0:n.textAlign;let g=0;for(let _=0,x=u.length;_<x;++_){let p;d?p=Qs(d*this.resolution,h,g,u[_],c):p=[h.slice(g,u[_])];for(let y=0,S=p.length;y<S;++y){const C=p[y];let w=0,E=C.length;if(f==null){const k=tn(n.maxAngle,C,0,C.length,2);w=k[0],E=k[1]}for(let k=w;k<E;k+=c)o.push(C[k],C[k+1]);const F=o.length;g=u[_],this.drawChars_(r,F),r=F}}this.endGeometry(e)}else{let u=n.overflow?null:[];switch(a){case"Point":case"MultiPoint":h=t.getFlatCoordinates();break;case"LineString":h=t.getFlatMidpoint();break;case"Circle":h=t.getCenter();break;case"MultiLineString":h=t.getFlatMidpoints(),c=2;break;case"Polygon":h=t.getFlatInteriorPoint(),n.overflow||u.push(h[2]/this.resolution),c=3;break;case"MultiPolygon":const p=t.getFlatInteriorPoints();h=[];for(let y=0,S=p.length;y<S;y+=3)n.overflow||u.push(p[y+2]/this.resolution),h.push(p[y],p[y+1]);if(h.length===0)return;c=2;break}const d=this.appendFlatPointCoordinates(h,c);if(d===r)return;if(u&&(d-r)/2!==h.length/c){let p=r/2;u=u.filter((y,S)=>{const C=o[(p+S)*2]===h[S*c]&&o[(p+S)*2+1]===h[S*c+1];return C||--p,C})}this.saveTextStates_(),(n.backgroundFill||n.backgroundStroke)&&(this.setFillStrokeStyle(n.backgroundFill,n.backgroundStroke),n.backgroundFill&&this.updateFillStyle(this.state,this.createFill),n.backgroundStroke&&(this.updateStrokeStyle(this.state,this.applyStroke),this.hitDetectionInstructions.push(this.createStroke(this.state)))),this.beginGeometry(t,e);let f=n.padding;if(f!=lt&&(n.scale[0]<0||n.scale[1]<0)){let p=n.padding[0],y=n.padding[1],S=n.padding[2],C=n.padding[3];n.scale[0]<0&&(y=-y,C=-C),n.scale[1]<0&&(p=-p,S=-S),f=[p,y,S,C]}const g=this.pixelRatio;this.instructions.push([I.DRAW_IMAGE,r,d,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[1,1],NaN,void 0,this.declutterImageWithText_,f==lt?lt:f.map(function(p){return p*g}),!!n.backgroundFill,!!n.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,u]);const _=1/g,x=this.state.fillStyle;n.backgroundFill&&(this.state.fillStyle=H,this.hitDetectionInstructions.push(this.createFill(this.state))),this.hitDetectionInstructions.push([I.DRAW_IMAGE,r,d,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[_,_],NaN,void 0,this.declutterImageWithText_,f,!!n.backgroundFill,!!n.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_?H:this.fillKey_,this.textOffsetX_,this.textOffsetY_,u]),n.backgroundFill&&(this.state.fillStyle=x,this.hitDetectionInstructions.push(this.createFill(this.state))),this.endGeometry(e)}}saveTextStates_(){const t=this.textStrokeState_,e=this.textState_,i=this.textFillState_,s=this.strokeKey_;t&&(s in this.strokeStates||(this.strokeStates[s]={strokeStyle:t.strokeStyle,lineCap:t.lineCap,lineDashOffset:t.lineDashOffset,lineWidth:t.lineWidth,lineJoin:t.lineJoin,miterLimit:t.miterLimit,lineDash:t.lineDash}));const n=this.textKey_;n in this.textStates||(this.textStates[n]={font:e.font,textAlign:e.textAlign||Rt,justify:e.justify,textBaseline:e.textBaseline||Ht,scale:e.scale});const o=this.fillKey_;i&&(o in this.fillStates||(this.fillStates[o]={fillStyle:i.fillStyle}))}drawChars_(t,e){const i=this.textStrokeState_,s=this.textState_,n=this.strokeKey_,o=this.textKey_,r=this.fillKey_;this.saveTextStates_();const a=this.pixelRatio,h=Kt[s.textBaseline],c=this.textOffsetY_*a,u=this.text_,d=i?i.lineWidth*Math.abs(s.scale[0])/2:0;this.instructions.push([I.DRAW_CHARS,t,e,h,s.overflow,r,s.maxAngle,a,c,n,d*a,u,o,1]),this.hitDetectionInstructions.push([I.DRAW_CHARS,t,e,h,s.overflow,r&&H,s.maxAngle,a,c,n,d*a,u,o,1/a])}setTextStyle(t,e){let i,s,n;if(!t)this.text_="";else{const o=t.getFill();o?(s=this.textFillState_,s||(s={},this.textFillState_=s),s.fillStyle=ot(o.getColor()||H)):(s=null,this.textFillState_=s);const r=t.getStroke();if(!r)n=null,this.textStrokeState_=n;else{n=this.textStrokeState_,n||(n={},this.textStrokeState_=n);const g=r.getLineDash(),_=r.getLineDashOffset(),x=r.getWidth(),p=r.getMiterLimit();n.lineCap=r.getLineCap()||jt,n.lineDash=g?g.slice():et,n.lineDashOffset=_===void 0?it:_,n.lineJoin=r.getLineJoin()||Nt,n.lineWidth=x===void 0?Xt:x,n.miterLimit=p===void 0?Jt:p,n.strokeStyle=ot(r.getColor()||Yt)}i=this.textState_;const a=t.getFont()||oi;Ai(a);const h=t.getScaleArray();i.overflow=t.getOverflow(),i.font=a,i.maxAngle=t.getMaxAngle(),i.placement=t.getPlacement(),i.textAlign=t.getTextAlign(),i.repeat=t.getRepeat(),i.justify=t.getJustify(),i.textBaseline=t.getTextBaseline()||Ht,i.backgroundFill=t.getBackgroundFill(),i.backgroundStroke=t.getBackgroundStroke(),i.padding=t.getPadding()||lt,i.scale=h===void 0?[1,1]:h;const c=t.getOffsetX(),u=t.getOffsetY(),d=t.getRotateWithView(),f=t.getRotation();this.text_=t.getText()||"",this.textOffsetX_=c===void 0?0:c,this.textOffsetY_=u===void 0?0:u,this.textRotateWithView_=d===void 0?!1:d,this.textRotation_=f===void 0?0:f,this.strokeKey_=n?(typeof n.strokeStyle=="string"?n.strokeStyle:It(n.strokeStyle))+n.lineCap+n.lineDashOffset+"|"+n.lineWidth+n.lineJoin+n.miterLimit+"["+n.lineDash.join()+"]":"",this.textKey_=i.font+i.scale+(i.textAlign||"?")+(i.repeat||"?")+(i.justify||"?")+(i.textBaseline||"?"),this.fillKey_=s?typeof s.fillStyle=="string"?s.fillStyle:"|"+It(s.fillStyle):""}this.declutterImageWithText_=e}}const sn={Circle:$e,Default:Lt,Image:Us,LineString:qs,Polygon:$e,Text:en};class nn{constructor(t,e,i,s){this.tolerance_=t,this.maxExtent_=e,this.pixelRatio_=s,this.resolution_=i,this.buildersByZIndex_={}}finish(){const t={};for(const e in this.buildersByZIndex_){t[e]=t[e]||{};const i=this.buildersByZIndex_[e];for(const s in i){const n=i[s].finish();t[e][s]=n}}return t}getBuilder(t,e){const i=t!==void 0?t.toString():"0";let s=this.buildersByZIndex_[i];s===void 0&&(s={},this.buildersByZIndex_[i]=s);let n=s[e];if(n===void 0){const o=sn[e];n=new o(this.tolerance_,this.maxExtent_,this.resolution_,this.pixelRatio_),s[e]=n}return n}}const Qe=nn;function on(l,t,e,i,s,n,o,r,a,h,c,u){let d=l[t],f=l[t+1],g=0,_=0,x=0,p=0;function y(){g=d,_=f,t+=i,d=l[t],f=l[t+1],p+=x,x=Math.sqrt((d-g)*(d-g)+(f-_)*(f-_))}do y();while(t<e-i&&p+x<n);let S=x===0?0:(n-p)/x;const C=V(g,d,S),w=V(_,f,S),E=t-i,F=p,k=n+r*a(h,s,c);for(;t<e-i&&p+x<k;)y();S=x===0?0:(k-p)/x;const O=V(g,d,S),M=V(_,f,S);let v;if(u){const R=[C,w,O,M];Wi(R,0,4,2,u,R,R),v=R[0]>R[2]}else v=C>O;const D=Math.PI,b=[],Y=E+i===t;t=E,x=0,p=F,d=l[t],f=l[t+1];let P;if(Y){y(),P=Math.atan2(f-_,d-g),v&&(P+=P>0?-D:D);const R=(O+C)/2,L=(M+w)/2;return b[0]=[R,L,(k-n)/2,P,s],b}s=s.replace(/\n/g," ");for(let R=0,L=s.length;R<L;){y();let T=Math.atan2(f-_,d-g);if(v&&(T+=T>0?-D:D),P!==void 0){let K=T-P;if(K+=K>D?-2*D:K<-D?2*D:0,Math.abs(K)>o)return null}P=T;const G=R;let A=0;for(;R<L;++R){const K=v?L-R-1:R,dt=r*a(h,s[K],c);if(t+i<e&&p+x<n+A+dt/2)break;A+=dt}if(R===G)continue;const Z=v?s.substring(L-G,L-R):s.substring(G,R);S=x===0?0:(n+A/2-p)/x;const m=V(g,d,S),Oe=V(_,f,S);b.push([m,Oe,A/2,T,Z]),n+=A}return b}function di(l,t,e,i){let s=l[t],n=l[t+1],o=0;for(let r=t+i;r<e;r+=i){const a=l[r],h=l[r+1];o+=Math.sqrt((a-s)*(a-s)+(h-n)*(h-n)),s=a,n=h}return o}const ft=Tt(),st=[],$=[],Q=[],nt=[];function ti(l){return l[3].declutterBox}const ei=new RegExp("["+String.fromCharCode(1425)+"-"+String.fromCharCode(2303)+String.fromCharCode(64285)+"-"+String.fromCharCode(65023)+String.fromCharCode(65136)+"-"+String.fromCharCode(65276)+String.fromCharCode(67584)+"-"+String.fromCharCode(69631)+String.fromCharCode(124928)+"-"+String.fromCharCode(126975)+"]");function de(l,t){return t==="start"?t=ei.test(l)?"right":"left":t==="end"&&(t=ei.test(l)?"left":"right"),Kt[t]}function rn(l,t,e){return e>0&&l.push(`
`,""),l.push(t,""),l}class an{constructor(t,e,i,s){this.overlaps=i,this.pixelRatio=e,this.resolution=t,this.alignFill_,this.instructions=s.instructions,this.coordinates=s.coordinates,this.coordinateCache_={},this.renderedTransform_=Vt(),this.hitDetectionInstructions=s.hitDetectionInstructions,this.pixelCoordinates_=null,this.viewRotation_=0,this.fillStates=s.fillStates||{},this.strokeStates=s.strokeStates||{},this.textStates=s.textStates||{},this.widths_={},this.labels_={}}createLabel(t,e,i,s){const n=t+e+i+s;if(this.labels_[n])return this.labels_[n];const o=s?this.strokeStates[s]:null,r=i?this.fillStates[i]:null,a=this.textStates[e],h=this.pixelRatio,c=[a.scale[0]*h,a.scale[1]*h],u=Array.isArray(t),d=a.justify?Kt[a.justify]:de(Array.isArray(t)?t[0]:t,a.textAlign||Rt),f=s&&o.lineWidth?o.lineWidth:0,g=u?t:t.split(`
`).reduce(rn,[]),{width:_,height:x,widths:p,heights:y,lineWidths:S}=Bi(a,g),C=_+f,w=[],E=(C+2)*c[0],F=(x+f)*c[1],k={width:E<0?Math.floor(E):Math.ceil(E),height:F<0?Math.floor(F):Math.ceil(F),contextInstructions:w};(c[0]!=1||c[1]!=1)&&w.push("scale",c),s&&(w.push("strokeStyle",o.strokeStyle),w.push("lineWidth",f),w.push("lineCap",o.lineCap),w.push("lineJoin",o.lineJoin),w.push("miterLimit",o.miterLimit),w.push("setLineDash",[o.lineDash]),w.push("lineDashOffset",o.lineDashOffset)),i&&w.push("fillStyle",r.fillStyle),w.push("textBaseline","middle"),w.push("textAlign","center");const O=.5-d;let M=d*C+O*f;const v=[],D=[];let b=0,Y=0,P=0,R=0,L;for(let T=0,G=g.length;T<G;T+=2){const A=g[T];if(A===`
`){Y+=b,b=0,M=d*C+O*f,++R;continue}const Z=g[T+1]||a.font;Z!==L&&(s&&v.push("font",Z),i&&D.push("font",Z),L=Z),b=Math.max(b,y[P]);const m=[A,M+O*p[P]+d*(p[P]-S[R]),.5*(f+b)+Y];M+=p[P],s&&v.push("strokeText",m),i&&D.push("fillText",m),++P}return Array.prototype.push.apply(w,v),Array.prototype.push.apply(w,D),this.labels_[n]=k,k}replayTextBackground_(t,e,i,s,n,o,r){t.beginPath(),t.moveTo.apply(t,e),t.lineTo.apply(t,i),t.lineTo.apply(t,s),t.lineTo.apply(t,n),t.lineTo.apply(t,e),o&&(this.alignFill_=o[2],this.fill_(t)),r&&(this.setStrokeStyle_(t,r),t.stroke())}calculateImageOrLabelDimensions_(t,e,i,s,n,o,r,a,h,c,u,d,f,g,_,x){r*=d[0],a*=d[1];let p=i-r,y=s-a;const S=n+h>t?t-h:n,C=o+c>e?e-c:o,w=g[3]+S*d[0]+g[1],E=g[0]+C*d[1]+g[2],F=p-g[3],k=y-g[0];(_||u!==0)&&(st[0]=F,nt[0]=F,st[1]=k,$[1]=k,$[0]=F+w,Q[0]=$[0],Q[1]=k+E,nt[1]=Q[1]);let O;return u!==0?(O=Ee(Vt(),i,s,1,1,u,-i,-s),gt(O,st),gt(O,$),gt(O,Q),gt(O,nt),Je(Math.min(st[0],$[0],Q[0],nt[0]),Math.min(st[1],$[1],Q[1],nt[1]),Math.max(st[0],$[0],Q[0],nt[0]),Math.max(st[1],$[1],Q[1],nt[1]),ft)):Je(Math.min(F,F+w),Math.min(k,k+E),Math.max(F,F+w),Math.max(k,k+E),ft),f&&(p=Math.round(p),y=Math.round(y)),{drawImageX:p,drawImageY:y,drawImageW:S,drawImageH:C,originX:h,originY:c,declutterBox:{minX:ft[0],minY:ft[1],maxX:ft[2],maxY:ft[3],value:x},canvasTransform:O,scale:d}}replayImageOrLabel_(t,e,i,s,n,o,r){const a=!!(o||r),h=s.declutterBox,c=t.canvas,u=r?r[2]*s.scale[0]/2:0;return h.minX-u<=c.width/e&&h.maxX+u>=0&&h.minY-u<=c.height/e&&h.maxY+u>=0&&(a&&this.replayTextBackground_(t,st,$,Q,nt,o,r),Yi(t,s.canvasTransform,n,i,s.originX,s.originY,s.drawImageW,s.drawImageH,s.drawImageX,s.drawImageY,s.scale)),!0}fill_(t){if(this.alignFill_){const e=gt(this.renderedTransform_,[0,0]),i=512*this.pixelRatio;t.save(),t.translate(e[0]%i,e[1]%i),t.rotate(this.viewRotation_)}t.fill(),this.alignFill_&&t.restore()}setStrokeStyle_(t,e){t.strokeStyle=e[1],t.lineWidth=e[2],t.lineCap=e[3],t.lineJoin=e[4],t.miterLimit=e[5],t.lineDashOffset=e[7],t.setLineDash(e[6])}drawLabelWithPointPlacement_(t,e,i,s){const n=this.textStates[e],o=this.createLabel(t,e,s,i),r=this.strokeStates[i],a=this.pixelRatio,h=de(Array.isArray(t)?t[0]:t,n.textAlign||Rt),c=Kt[n.textBaseline||Ht],u=r&&r.lineWidth?r.lineWidth:0,d=o.width/a-2*n.scale[0],f=h*d+2*(.5-h)*u,g=c*o.height/a+2*(.5-c)*u;return{label:o,anchorX:f,anchorY:g}}execute_(t,e,i,s,n,o,r,a){let h;this.pixelCoordinates_&&Qt(i,this.renderedTransform_)?h=this.pixelCoordinates_:(this.pixelCoordinates_||(this.pixelCoordinates_=[]),h=Ct(this.coordinates,0,this.coordinates.length,2,i,this.pixelCoordinates_),ji(this.renderedTransform_,i));let c=0;const u=s.length;let d=0,f,g,_,x,p,y,S,C,w,E,F,k,O=0,M=0,v=null,D=null;const b=this.coordinateCache_,Y=this.viewRotation_,P=Math.round(Math.atan2(-i[1],i[0])*1e12)/1e12,R={context:t,pixelRatio:this.pixelRatio,resolution:this.resolution,rotation:Y},L=this.instructions!=s||this.overlaps?0:200;let T,G,A,Z;for(;c<u;){const m=s[c];switch(m[0]){case I.BEGIN_GEOMETRY:T=m[1],Z=m[3],T.getGeometry()?r!==void 0&&!tt(r,Z.getExtent())?c=m[2]+1:++c:c=m[2];break;case I.BEGIN_PATH:O>L&&(this.fill_(t),O=0),M>L&&(t.stroke(),M=0),!O&&!M&&(t.beginPath(),x=NaN,p=NaN),++c;break;case I.CIRCLE:d=m[1];const K=h[d],dt=h[d+1],yi=h[d+2],Si=h[d+3],Me=yi-K,be=Si-dt,Pe=Math.sqrt(Me*Me+be*be);t.moveTo(K+Pe,dt),t.arc(K,dt,Pe,0,2*Math.PI,!0),++c;break;case I.CLOSE_PATH:t.closePath(),++c;break;case I.CUSTOM:d=m[1],f=m[2];const Ci=m[3],wi=m[4],De=m.length==6?m[5]:void 0;R.geometry=Ci,R.feature=T,c in b||(b[c]=[]);const pt=b[c];De?De(h,d,f,2,pt):(pt[0]=h[d],pt[1]=h[d+1],pt.length=2),wi(pt,R),++c;break;case I.DRAW_IMAGE:d=m[1],f=m[2],C=m[3],g=m[4],_=m[5];let ne=m[6];const Ri=m[7],Ii=m[8],Ti=m[9],Ge=m[10];let oe=m[11];const ki=m[12];let Ft=m[13];const ve=m[14],xt=m[15];if(!C&&m.length>=20){w=m[19],E=m[20],F=m[21],k=m[22];const j=this.drawLabelWithPointPlacement_(w,E,F,k);C=j.label,m[3]=C;const ut=m[23];g=(j.anchorX-ut)*this.pixelRatio,m[4]=g;const X=m[24];_=(j.anchorY-X)*this.pixelRatio,m[5]=_,ne=C.height,m[6]=ne,Ft=C.width,m[13]=Ft}let re;m.length>25&&(re=m[25]);let ae,Ot,Mt;m.length>17?(ae=m[16],Ot=m[17],Mt=m[18]):(ae=lt,Ot=!1,Mt=!1),Ge&&P?oe+=Y:!Ge&&!P&&(oe-=Y);let Ei=0;for(;d<f;d+=2){if(re&&re[Ei++]<Ft/this.pixelRatio)continue;const j=this.calculateImageOrLabelDimensions_(C.width,C.height,h[d],h[d+1],Ft,ne,g,_,Ii,Ti,oe,ki,n,ae,Ot||Mt,T),ut=[t,e,C,j,Ri,Ot?v:null,Mt?D:null];if(a){if(ve==="none")continue;if(ve==="obstacle"){a.insert(j.declutterBox);continue}else{let X,z;if(xt){const N=f-d;if(!xt[N]){xt[N]=ut;continue}if(X=xt[N],delete xt[N],z=ti(X),a.collides(z))continue}if(a.collides(j.declutterBox))continue;X&&(a.insert(z),this.replayImageOrLabel_.apply(this,X)),a.insert(j.declutterBox)}}this.replayImageOrLabel_.apply(this,ut)}++c;break;case I.DRAW_CHARS:const Ae=m[1],We=m[2],le=m[3],Li=m[4];k=m[5];const Fi=m[6],Be=m[7],Ye=m[8];F=m[9];const he=m[10];w=m[11],E=m[12];const je=[m[13],m[13]],ce=this.textStates[E],mt=ce.font,yt=[ce.scale[0]*Be,ce.scale[1]*Be];let St;mt in this.widths_?St=this.widths_[mt]:(St={},this.widths_[mt]=St);const Ne=di(h,Ae,We,2),Xe=Math.abs(yt[0])*He(mt,w,St);if(Li||Xe<=Ne){const j=this.textStates[E].textAlign,ut=(Ne-Xe)*de(w,j),X=on(h,Ae,We,2,w,ut,Fi,Math.abs(yt[0]),He,mt,St,P?0:this.viewRotation_);t:if(X){const z=[];let N,bt,Pt,B,J;if(F)for(N=0,bt=X.length;N<bt;++N){J=X[N],Pt=J[4],B=this.createLabel(Pt,E,"",F),g=J[2]+(yt[0]<0?-he:he),_=le*B.height+(.5-le)*2*he*yt[1]/yt[0]-Ye;const q=this.calculateImageOrLabelDimensions_(B.width,B.height,J[0],J[1],B.width,B.height,g,_,0,0,J[3],je,!1,lt,!1,T);if(a&&a.collides(q.declutterBox))break t;z.push([t,e,B,q,1,null,null])}if(k)for(N=0,bt=X.length;N<bt;++N){J=X[N],Pt=J[4],B=this.createLabel(Pt,E,k,""),g=J[2],_=le*B.height-Ye;const q=this.calculateImageOrLabelDimensions_(B.width,B.height,J[0],J[1],B.width,B.height,g,_,0,0,J[3],je,!1,lt,!1,T);if(a&&a.collides(q.declutterBox))break t;z.push([t,e,B,q,1,null,null])}a&&a.load(z.map(ti));for(let q=0,Oi=z.length;q<Oi;++q)this.replayImageOrLabel_.apply(this,z[q])}}++c;break;case I.END_GEOMETRY:if(o!==void 0){T=m[1];const j=o(T,Z);if(j)return j}++c;break;case I.FILL:L?O++:this.fill_(t),++c;break;case I.MOVE_TO_LINE_TO:for(d=m[1],f=m[2],G=h[d],A=h[d+1],y=G+.5|0,S=A+.5|0,(y!==x||S!==p)&&(t.moveTo(G,A),x=y,p=S),d+=2;d<f;d+=2)G=h[d],A=h[d+1],y=G+.5|0,S=A+.5|0,(d==f-2||y!==x||S!==p)&&(t.lineTo(G,A),x=y,p=S);++c;break;case I.SET_FILL_STYLE:v=m,this.alignFill_=m[2],O&&(this.fill_(t),O=0,M&&(t.stroke(),M=0)),t.fillStyle=m[1],++c;break;case I.SET_STROKE_STYLE:D=m,M&&(t.stroke(),M=0),this.setStrokeStyle_(t,m),++c;break;case I.STROKE:L?M++:t.stroke(),++c;break;default:++c;break}}O&&this.fill_(t),M&&t.stroke()}execute(t,e,i,s,n,o){this.viewRotation_=s,this.execute_(t,e,i,this.instructions,n,void 0,void 0,o)}executeHitDetection(t,e,i,s,n){return this.viewRotation_=i,this.execute_(t,1,e,this.hitDetectionInstructions,!0,s,n)}}const ln=an,ue=["Polygon","Circle","LineString","Image","Text","Default"];class hn{constructor(t,e,i,s,n,o){this.maxExtent_=t,this.overlaps_=s,this.pixelRatio_=i,this.resolution_=e,this.renderBuffer_=o,this.executorsByZIndex_={},this.hitDetectionContext_=null,this.hitDetectionTransform_=Vt(),this.createExecutors_(n)}clip(t,e){const i=this.getClipCoords(e);t.beginPath(),t.moveTo(i[0],i[1]),t.lineTo(i[2],i[3]),t.lineTo(i[4],i[5]),t.lineTo(i[6],i[7]),t.clip()}createExecutors_(t){for(const e in t){let i=this.executorsByZIndex_[e];i===void 0&&(i={},this.executorsByZIndex_[e]=i);const s=t[e];for(const n in s){const o=s[n];i[n]=new ln(this.resolution_,this.pixelRatio_,this.overlaps_,o)}}}hasExecutors(t){for(const e in this.executorsByZIndex_){const i=this.executorsByZIndex_[e];for(let s=0,n=t.length;s<n;++s)if(t[s]in i)return!0}return!1}forEachFeatureAtCoordinate(t,e,i,s,n,o){s=Math.round(s);const r=s*2+1,a=Ee(this.hitDetectionTransform_,s+.5,s+.5,1/e,-1/e,-i,-t[0],-t[1]),h=!this.hitDetectionContext_;h&&(this.hitDetectionContext_=Zt(r,r,void 0,{willReadFrequently:!0}));const c=this.hitDetectionContext_;c.canvas.width!==r||c.canvas.height!==r?(c.canvas.width=r,c.canvas.height=r):h||c.clearRect(0,0,r,r);let u;this.renderBuffer_!==void 0&&(u=Tt(),Ni(u,t),ke(u,e*(this.renderBuffer_+s),u));const d=cn(s);let f;function g(w,E){const F=c.getImageData(0,0,r,r).data;for(let k=0,O=d.length;k<O;k++)if(F[d[k]]>0){if(!o||f!=="Image"&&f!=="Text"||o.includes(w)){const M=(d[k]-3)/4,v=s-M%r,D=s-(M/r|0),b=n(w,E,v*v+D*D);if(b)return b}c.clearRect(0,0,r,r);break}}const _=Object.keys(this.executorsByZIndex_).map(Number);_.sort(xe);let x,p,y,S,C;for(x=_.length-1;x>=0;--x){const w=_[x].toString();for(y=this.executorsByZIndex_[w],p=ue.length-1;p>=0;--p)if(f=ue[p],S=y[f],S!==void 0&&(C=S.executeHitDetection(c,a,i,g,u),C))return C}}getClipCoords(t){const e=this.maxExtent_;if(!e)return null;const i=e[0],s=e[1],n=e[2],o=e[3],r=[i,s,i,o,n,o,n,s];return Ct(r,0,8,2,t,r),r}isEmpty(){return ri(this.executorsByZIndex_)}execute(t,e,i,s,n,o,r){const a=Object.keys(this.executorsByZIndex_).map(Number);a.sort(xe),this.maxExtent_&&(t.save(),this.clip(t,i)),o=o||ue;let h,c,u,d,f,g;for(r&&a.reverse(),h=0,c=a.length;h<c;++h){const _=a[h].toString();for(f=this.executorsByZIndex_[_],u=0,d=o.length;u<d;++u){const x=o[u];g=f[x],g!==void 0&&g.execute(t,e,i,s,n,r)}}this.maxExtent_&&t.restore()}}const fe={};function cn(l){if(fe[l]!==void 0)return fe[l];const t=l*2+1,e=l*l,i=new Array(e+1);for(let n=0;n<=l;++n)for(let o=0;o<=l;++o){const r=n*n+o*o;if(r>e)break;let a=i[r];a||(a=[],i[r]=a),a.push(((l+n)*t+(l+o))*4+3),n>0&&a.push(((l-n)*t+(l+o))*4+3),o>0&&(a.push(((l+n)*t+(l-o))*4+3),n>0&&a.push(((l-n)*t+(l-o))*4+3))}const s=[];for(let n=0,o=i.length;n<o;++n)i[n]&&s.push(...i[n]);return fe[l]=s,s}const ii=hn;class dn extends ci{constructor(t,e,i,s,n,o,r){super(),this.context_=t,this.pixelRatio_=e,this.extent_=i,this.transform_=s,this.transformRotation_=s?Xi(Math.atan2(s[1],s[0]),10):0,this.viewRotation_=n,this.squaredTolerance_=o,this.userTransform_=r,this.contextFillState_=null,this.contextStrokeState_=null,this.contextTextState_=null,this.fillState_=null,this.strokeState_=null,this.image_=null,this.imageAnchorX_=0,this.imageAnchorY_=0,this.imageHeight_=0,this.imageOpacity_=0,this.imageOriginX_=0,this.imageOriginY_=0,this.imageRotateWithView_=!1,this.imageRotation_=0,this.imageScale_=[0,0],this.imageWidth_=0,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=!1,this.textRotation_=0,this.textScale_=[0,0],this.textFillState_=null,this.textStrokeState_=null,this.textState_=null,this.pixelCoordinates_=[],this.tmpLocalTransform_=Vt()}drawImages_(t,e,i,s){if(!this.image_)return;const n=Ct(t,e,i,s,this.transform_,this.pixelCoordinates_),o=this.context_,r=this.tmpLocalTransform_,a=o.globalAlpha;this.imageOpacity_!=1&&(o.globalAlpha=a*this.imageOpacity_);let h=this.imageRotation_;this.transformRotation_===0&&(h-=this.viewRotation_),this.imageRotateWithView_&&(h+=this.viewRotation_);for(let c=0,u=n.length;c<u;c+=2){const d=n[c]-this.imageAnchorX_,f=n[c+1]-this.imageAnchorY_;if(h!==0||this.imageScale_[0]!=1||this.imageScale_[1]!=1){const g=d+this.imageAnchorX_,_=f+this.imageAnchorY_;Ee(r,g,_,1,1,h,-g,-_),o.save(),o.transform.apply(o,r),o.translate(g,_),o.scale(this.imageScale_[0],this.imageScale_[1]),o.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,-this.imageAnchorX_,-this.imageAnchorY_,this.imageWidth_,this.imageHeight_),o.restore()}else o.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,d,f,this.imageWidth_,this.imageHeight_)}this.imageOpacity_!=1&&(o.globalAlpha=a)}drawText_(t,e,i,s){if(!this.textState_||this.text_==="")return;this.textFillState_&&this.setContextFillState_(this.textFillState_),this.textStrokeState_&&this.setContextStrokeState_(this.textStrokeState_),this.setContextTextState_(this.textState_);const n=Ct(t,e,i,s,this.transform_,this.pixelCoordinates_),o=this.context_;let r=this.textRotation_;for(this.transformRotation_===0&&(r-=this.viewRotation_),this.textRotateWithView_&&(r+=this.viewRotation_);e<i;e+=s){const a=n[e]+this.textOffsetX_,h=n[e+1]+this.textOffsetY_;r!==0||this.textScale_[0]!=1||this.textScale_[1]!=1?(o.save(),o.translate(a-this.textOffsetX_,h-this.textOffsetY_),o.rotate(r),o.translate(this.textOffsetX_,this.textOffsetY_),o.scale(this.textScale_[0],this.textScale_[1]),this.textStrokeState_&&o.strokeText(this.text_,0,0),this.textFillState_&&o.fillText(this.text_,0,0),o.restore()):(this.textStrokeState_&&o.strokeText(this.text_,a,h),this.textFillState_&&o.fillText(this.text_,a,h))}}moveToLineTo_(t,e,i,s,n){const o=this.context_,r=Ct(t,e,i,s,this.transform_,this.pixelCoordinates_);o.moveTo(r[0],r[1]);let a=r.length;n&&(a-=2);for(let h=2;h<a;h+=2)o.lineTo(r[h],r[h+1]);return n&&o.closePath(),i}drawRings_(t,e,i,s){for(let n=0,o=i.length;n<o;++n)e=this.moveToLineTo_(t,e,i[n],s,!0);return e}drawCircle(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!tt(this.extent_,t.getExtent())){if(this.fillState_||this.strokeState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=Ji(t,this.transform_,this.pixelCoordinates_),i=e[2]-e[0],s=e[3]-e[1],n=Math.sqrt(i*i+s*s),o=this.context_;o.beginPath(),o.arc(e[0],e[1],n,0,2*Math.PI),this.fillState_&&o.fill(),this.strokeState_&&o.stroke()}this.text_!==""&&this.drawText_(t.getCenter(),0,2,2)}}setStyle(t){this.setFillStrokeStyle(t.getFill(),t.getStroke()),this.setImageStyle(t.getImage()),this.setTextStyle(t.getText())}setTransform(t){this.transform_=t}drawGeometry(t){switch(t.getType()){case"Point":this.drawPoint(t);break;case"LineString":this.drawLineString(t);break;case"Polygon":this.drawPolygon(t);break;case"MultiPoint":this.drawMultiPoint(t);break;case"MultiLineString":this.drawMultiLineString(t);break;case"MultiPolygon":this.drawMultiPolygon(t);break;case"GeometryCollection":this.drawGeometryCollection(t);break;case"Circle":this.drawCircle(t);break}}drawFeature(t,e){const i=e.getGeometryFunction()(t);i&&(this.setStyle(e),this.drawGeometry(i))}drawGeometryCollection(t){const e=t.getGeometriesArray();for(let i=0,s=e.length;i<s;++i)this.drawGeometry(e[i])}drawPoint(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getFlatCoordinates(),i=t.getStride();this.image_&&this.drawImages_(e,0,e.length,i),this.text_!==""&&this.drawText_(e,0,e.length,i)}drawMultiPoint(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getFlatCoordinates(),i=t.getStride();this.image_&&this.drawImages_(e,0,e.length,i),this.text_!==""&&this.drawText_(e,0,e.length,i)}drawLineString(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!tt(this.extent_,t.getExtent())){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const e=this.context_,i=t.getFlatCoordinates();e.beginPath(),this.moveToLineTo_(i,0,i.length,t.getStride(),!1),e.stroke()}if(this.text_!==""){const e=t.getFlatMidpoint();this.drawText_(e,0,2,2)}}}drawMultiLineString(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getExtent();if(tt(this.extent_,e)){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const i=this.context_,s=t.getFlatCoordinates();let n=0;const o=t.getEnds(),r=t.getStride();i.beginPath();for(let a=0,h=o.length;a<h;++a)n=this.moveToLineTo_(s,n,o[a],r,!1);i.stroke()}if(this.text_!==""){const i=t.getFlatMidpoints();this.drawText_(i,0,i.length,2)}}}drawPolygon(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!tt(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=this.context_;e.beginPath(),this.drawRings_(t.getOrientedFlatCoordinates(),0,t.getEnds(),t.getStride()),this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(this.text_!==""){const e=t.getFlatInteriorPoint();this.drawText_(e,0,2,2)}}}drawMultiPolygon(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!tt(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=this.context_,i=t.getOrientedFlatCoordinates();let s=0;const n=t.getEndss(),o=t.getStride();e.beginPath();for(let r=0,a=n.length;r<a;++r){const h=n[r];s=this.drawRings_(i,s,h,o)}this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(this.text_!==""){const e=t.getFlatInteriorPoints();this.drawText_(e,0,e.length,2)}}}setContextFillState_(t){const e=this.context_,i=this.contextFillState_;i?i.fillStyle!=t.fillStyle&&(i.fillStyle=t.fillStyle,e.fillStyle=t.fillStyle):(e.fillStyle=t.fillStyle,this.contextFillState_={fillStyle:t.fillStyle})}setContextStrokeState_(t){const e=this.context_,i=this.contextStrokeState_;i?(i.lineCap!=t.lineCap&&(i.lineCap=t.lineCap,e.lineCap=t.lineCap),Qt(i.lineDash,t.lineDash)||e.setLineDash(i.lineDash=t.lineDash),i.lineDashOffset!=t.lineDashOffset&&(i.lineDashOffset=t.lineDashOffset,e.lineDashOffset=t.lineDashOffset),i.lineJoin!=t.lineJoin&&(i.lineJoin=t.lineJoin,e.lineJoin=t.lineJoin),i.lineWidth!=t.lineWidth&&(i.lineWidth=t.lineWidth,e.lineWidth=t.lineWidth),i.miterLimit!=t.miterLimit&&(i.miterLimit=t.miterLimit,e.miterLimit=t.miterLimit),i.strokeStyle!=t.strokeStyle&&(i.strokeStyle=t.strokeStyle,e.strokeStyle=t.strokeStyle)):(e.lineCap=t.lineCap,e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset,e.lineJoin=t.lineJoin,e.lineWidth=t.lineWidth,e.miterLimit=t.miterLimit,e.strokeStyle=t.strokeStyle,this.contextStrokeState_={lineCap:t.lineCap,lineDash:t.lineDash,lineDashOffset:t.lineDashOffset,lineJoin:t.lineJoin,lineWidth:t.lineWidth,miterLimit:t.miterLimit,strokeStyle:t.strokeStyle})}setContextTextState_(t){const e=this.context_,i=this.contextTextState_,s=t.textAlign?t.textAlign:Rt;i?(i.font!=t.font&&(i.font=t.font,e.font=t.font),i.textAlign!=s&&(i.textAlign=s,e.textAlign=s),i.textBaseline!=t.textBaseline&&(i.textBaseline=t.textBaseline,e.textBaseline=t.textBaseline)):(e.font=t.font,e.textAlign=s,e.textBaseline=t.textBaseline,this.contextTextState_={font:t.font,textAlign:s,textBaseline:t.textBaseline})}setFillStrokeStyle(t,e){if(!t)this.fillState_=null;else{const i=t.getColor();this.fillState_={fillStyle:ot(i||H)}}if(!e)this.strokeState_=null;else{const i=e.getColor(),s=e.getLineCap(),n=e.getLineDash(),o=e.getLineDashOffset(),r=e.getLineJoin(),a=e.getWidth(),h=e.getMiterLimit(),c=n||et;this.strokeState_={lineCap:s!==void 0?s:jt,lineDash:this.pixelRatio_===1?c:c.map(u=>u*this.pixelRatio_),lineDashOffset:(o||it)*this.pixelRatio_,lineJoin:r!==void 0?r:Nt,lineWidth:(a!==void 0?a:Xt)*this.pixelRatio_,miterLimit:h!==void 0?h:Jt,strokeStyle:ot(i||Yt)}}}setImageStyle(t){let e;if(!t||!(e=t.getSize())){this.image_=null;return}const i=t.getPixelRatio(this.pixelRatio_),s=t.getAnchor(),n=t.getOrigin();this.image_=t.getImage(this.pixelRatio_),this.imageAnchorX_=s[0]*i,this.imageAnchorY_=s[1]*i,this.imageHeight_=e[1]*i,this.imageOpacity_=t.getOpacity(),this.imageOriginX_=n[0],this.imageOriginY_=n[1],this.imageRotateWithView_=t.getRotateWithView(),this.imageRotation_=t.getRotation();const o=t.getScaleArray();this.imageScale_=[o[0]*this.pixelRatio_/i,o[1]*this.pixelRatio_/i],this.imageWidth_=e[0]*i}setTextStyle(t){if(!t)this.text_="";else{const e=t.getFill();if(!e)this.textFillState_=null;else{const f=e.getColor();this.textFillState_={fillStyle:ot(f||H)}}const i=t.getStroke();if(!i)this.textStrokeState_=null;else{const f=i.getColor(),g=i.getLineCap(),_=i.getLineDash(),x=i.getLineDashOffset(),p=i.getLineJoin(),y=i.getWidth(),S=i.getMiterLimit();this.textStrokeState_={lineCap:g!==void 0?g:jt,lineDash:_||et,lineDashOffset:x||it,lineJoin:p!==void 0?p:Nt,lineWidth:y!==void 0?y:Xt,miterLimit:S!==void 0?S:Jt,strokeStyle:ot(f||Yt)}}const s=t.getFont(),n=t.getOffsetX(),o=t.getOffsetY(),r=t.getRotateWithView(),a=t.getRotation(),h=t.getScaleArray(),c=t.getText(),u=t.getTextAlign(),d=t.getTextBaseline();this.textState_={font:s!==void 0?s:oi,textAlign:u!==void 0?u:Rt,textBaseline:d!==void 0?d:Ht},this.text_=c!==void 0?Array.isArray(c)?c.reduce((f,g,_)=>f+=_%2?" ":g,""):c:"",this.textOffsetX_=n!==void 0?this.pixelRatio_*n:0,this.textOffsetY_=o!==void 0?this.pixelRatio_*o:0,this.textRotateWithView_=r!==void 0?r:!1,this.textRotation_=a!==void 0?a:0,this.textScale_=[this.pixelRatio_*h[0],this.pixelRatio_*h[1]]}}}const un=dn,U=.5;function fn(l,t,e,i,s,n,o){const r=l[0]*U,a=l[1]*U,h=Zt(r,a);h.imageSmoothingEnabled=!1;const c=h.canvas,u=new un(h,U,s,null,o),d=e.length,f=Math.floor((256*256*256-1)/d),g={};for(let x=1;x<=d;++x){const p=e[x-1],y=p.getStyleFunction()||i;if(!y)continue;let S=y(p,n);if(!S)continue;Array.isArray(S)||(S=[S]);const w=(x*f).toString(16).padStart(7,"#00000");for(let E=0,F=S.length;E<F;++E){const k=S[E],O=k.getGeometryFunction()(p);if(!O||!tt(s,O.getExtent()))continue;const M=k.clone(),v=M.getFill();v&&v.setColor(w);const D=M.getStroke();D&&(D.setColor(w),D.setLineDash(null)),M.setText(void 0);const b=k.getImage();if(b){const L=b.getImageSize();if(!L)continue;const T=Zt(L[0],L[1],void 0,{alpha:!1}),G=T.canvas;T.fillStyle=w,T.fillRect(0,0,G.width,G.height),M.setImage(new Hi({img:G,anchor:b.getAnchor(),anchorXUnits:"pixels",anchorYUnits:"pixels",offset:b.getOrigin(),opacity:1,size:b.getSize(),scale:b.getScale(),rotation:b.getRotation(),rotateWithView:b.getRotateWithView()}))}const Y=M.getZIndex()||0;let P=g[Y];P||(P={},g[Y]=P,P.Polygon=[],P.Circle=[],P.LineString=[],P.Point=[]);const R=O.getType();if(R==="GeometryCollection"){const L=O.getGeometriesArrayRecursive();for(let T=0,G=L.length;T<G;++T){const A=L[T];P[A.getType().replace("Multi","")].push(A,M)}}else P[R.replace("Multi","")].push(O,M)}}const _=Object.keys(g).map(Number).sort(xe);for(let x=0,p=_.length;x<p;++x){const y=g[_[x]];for(const S in y){const C=y[S];for(let w=0,E=C.length;w<E;w+=2){u.setStyle(C[w+1]);for(let F=0,k=t.length;F<k;++F)u.setTransform(t[F]),u.drawGeometry(C[w])}}}return h.getImageData(0,0,c.width,c.height)}function gn(l,t,e){const i=[];if(e){const s=Math.floor(Math.round(l[0])*U),n=Math.floor(Math.round(l[1])*U),o=(Ve(s,0,e.width-1)+Ve(n,0,e.height-1)*e.width)*4,r=e.data[o],a=e.data[o+1],c=e.data[o+2]+256*(a+256*r),u=Math.floor((256*256*256-1)/t.length);c&&c%u===0&&i.push(t[c/u-1])}return i}const _n=.5,ui={Point:In,LineString:Cn,Polygon:kn,MultiPoint:Tn,MultiLineString:wn,MultiPolygon:Rn,GeometryCollection:Sn,Circle:mn};function pn(l,t){return parseInt(It(l),10)-parseInt(It(t),10)}function xn(l,t){const e=Se(l,t);return e*e}function Se(l,t){return _n*l/t}function mn(l,t,e,i,s){const n=e.getFill(),o=e.getStroke();if(n||o){const a=l.getBuilder(e.getZIndex(),"Circle");a.setFillStrokeStyle(n,o),a.drawCircle(t,i)}const r=e.getText();if(r&&r.getText()){const a=(s||l).getBuilder(e.getZIndex(),"Text");a.setTextStyle(r),a.drawText(t,i)}}function si(l,t,e,i,s,n,o){let r=!1;const a=e.getImage();if(a){const h=a.getImageState();h==wt.LOADED||h==wt.ERROR?a.unlistenImageChange(s):(h==wt.IDLE&&a.load(),a.listenImageChange(s),r=!0)}return yn(l,t,e,i,n,o),r}function yn(l,t,e,i,s,n){const o=e.getGeometryFunction()(t);if(!o)return;const r=o.simplifyTransformed(i,s);if(e.getRenderer())fi(l,r,e,t);else{const h=ui[r.getType()];h(l,r,e,t,n)}}function fi(l,t,e,i){if(t.getType()=="GeometryCollection"){const n=t.getGeometries();for(let o=0,r=n.length;o<r;++o)fi(l,n[o],e,i);return}l.getBuilder(e.getZIndex(),"Default").drawCustom(t,i,e.getRenderer(),e.getHitDetectionRenderer())}function Sn(l,t,e,i,s){const n=t.getGeometriesArray();let o,r;for(o=0,r=n.length;o<r;++o){const a=ui[n[o].getType()];a(l,n[o],e,i,s)}}function Cn(l,t,e,i,s){const n=e.getStroke();if(n){const r=l.getBuilder(e.getZIndex(),"LineString");r.setFillStrokeStyle(null,n),r.drawLineString(t,i)}const o=e.getText();if(o&&o.getText()){const r=(s||l).getBuilder(e.getZIndex(),"Text");r.setTextStyle(o),r.drawText(t,i)}}function wn(l,t,e,i,s){const n=e.getStroke();if(n){const r=l.getBuilder(e.getZIndex(),"LineString");r.setFillStrokeStyle(null,n),r.drawMultiLineString(t,i)}const o=e.getText();if(o&&o.getText()){const r=(s||l).getBuilder(e.getZIndex(),"Text");r.setTextStyle(o),r.drawText(t,i)}}function Rn(l,t,e,i,s){const n=e.getFill(),o=e.getStroke();if(o||n){const a=l.getBuilder(e.getZIndex(),"Polygon");a.setFillStrokeStyle(n,o),a.drawMultiPolygon(t,i)}const r=e.getText();if(r&&r.getText()){const a=(s||l).getBuilder(e.getZIndex(),"Text");a.setTextStyle(r),a.drawText(t,i)}}function In(l,t,e,i,s){const n=e.getImage(),o=e.getText();let r;if(n){if(n.getImageState()!=wt.LOADED)return;let a=l;if(s){const c=n.getDeclutterMode();if(c!=="none")if(a=s,c==="obstacle"){const u=l.getBuilder(e.getZIndex(),"Image");u.setImageStyle(n,r),u.drawPoint(t,i)}else o&&o.getText()&&(r={})}const h=a.getBuilder(e.getZIndex(),"Image");h.setImageStyle(n,r),h.drawPoint(t,i)}if(o&&o.getText()){let a=l;s&&(a=s);const h=a.getBuilder(e.getZIndex(),"Text");h.setTextStyle(o,r),h.drawText(t,i)}}function Tn(l,t,e,i,s){const n=e.getImage(),o=e.getText();let r;if(n){if(n.getImageState()!=wt.LOADED)return;let a=l;if(s){const c=n.getDeclutterMode();if(c!=="none")if(a=s,c==="obstacle"){const u=l.getBuilder(e.getZIndex(),"Image");u.setImageStyle(n,r),u.drawMultiPoint(t,i)}else o&&o.getText()&&(r={})}const h=a.getBuilder(e.getZIndex(),"Image");h.setImageStyle(n,r),h.drawMultiPoint(t,i)}if(o&&o.getText()){let a=l;s&&(a=s);const h=a.getBuilder(e.getZIndex(),"Text");h.setTextStyle(o,r),h.drawText(t,i)}}function kn(l,t,e,i,s){const n=e.getFill(),o=e.getStroke();if(n||o){const a=l.getBuilder(e.getZIndex(),"Polygon");a.setFillStrokeStyle(n,o),a.drawPolygon(t,i)}const r=e.getText();if(r&&r.getText()){const a=(s||l).getBuilder(e.getZIndex(),"Text");a.setTextStyle(r),a.drawText(t,i)}}class En extends Vi{constructor(t){super(t),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.animatingOrInteracting_,this.hitDetectionImageData_=null,this.renderedFeatures_=null,this.renderedRevision_=-1,this.renderedResolution_=NaN,this.renderedExtent_=Tt(),this.wrappedRenderedExtent_=Tt(),this.renderedRotation_,this.renderedCenter_=null,this.renderedProjection_=null,this.renderedRenderOrder_=null,this.replayGroup_=null,this.replayGroupChanged=!0,this.declutterExecutorGroup=null,this.clipping=!0,this.compositionContext_=null,this.opacity_=1}renderWorlds(t,e,i){const s=e.extent,n=e.viewState,o=n.center,r=n.resolution,a=n.projection,h=n.rotation,c=a.getExtent(),u=this.getLayer().getSource(),d=e.pixelRatio,f=e.viewHints,g=!(f[Dt.ANIMATING]||f[Dt.INTERACTING]),_=this.compositionContext_,x=Math.round(e.size[0]*d),p=Math.round(e.size[1]*d),y=u.getWrapX()&&a.canWrapX(),S=y?Gt(c):null,C=y?Math.ceil((s[2]-c[2])/S)+1:1;let w=y?Math.floor((s[0]-c[0])/S):0;do{const E=this.getRenderTransform(o,r,h,d,x,p,w*S);t.execute(_,1,E,h,g,void 0,i)}while(++w<C)}setupCompositionContext_(){if(this.opacity_!==1){const t=Zt(this.context.canvas.width,this.context.canvas.height,Ze);this.compositionContext_=t}else this.compositionContext_=this.context}releaseCompositionContext_(){if(this.opacity_!==1){const t=this.context.globalAlpha;this.context.globalAlpha=this.opacity_,this.context.drawImage(this.compositionContext_.canvas,0,0),this.context.globalAlpha=t,Zi(this.compositionContext_),Ze.push(this.compositionContext_.canvas),this.compositionContext_=null}}renderDeclutter(t){this.declutterExecutorGroup&&(this.setupCompositionContext_(),this.renderWorlds(this.declutterExecutorGroup,t,t.declutterTree),this.releaseCompositionContext_())}renderFrame(t,e){const i=t.pixelRatio,s=t.layerStatesArray[t.layerIndex];Ki(this.pixelTransform,1/i,1/i),Ui(this.inversePixelTransform,this.pixelTransform);const n=zi(this.pixelTransform);this.useContainer(e,n,this.getBackground(t));const o=this.context,r=o.canvas,a=this.replayGroup_,h=this.declutterExecutorGroup;let c=a&&!a.isEmpty()||h&&!h.isEmpty();if(!c&&!(this.getLayer().hasListener(Ke.PRERENDER)||this.getLayer().hasListener(Ke.POSTRENDER)))return null;const u=Math.round(t.size[0]*i),d=Math.round(t.size[1]*i);r.width!=u||r.height!=d?(r.width=u,r.height=d,r.style.transform!==n&&(r.style.transform=n)):this.containerReused||o.clearRect(0,0,u,d),this.preRender(o,t);const f=t.viewState,g=f.projection;this.opacity_=s.opacity,this.setupCompositionContext_();let _=!1;if(c&&s.extent&&this.clipping){const x=qi(s.extent,g);c=tt(x,t.extent),_=c&&!vt(x,t.extent),_&&this.clipUnrotated(this.compositionContext_,t,x)}return c&&this.renderWorlds(a,t),_&&this.compositionContext_.restore(),this.releaseCompositionContext_(),this.postRender(o,t),this.renderedRotation_!==f.rotation&&(this.renderedRotation_=f.rotation,this.hitDetectionImageData_=null),this.container}getFeatures(t){return new Promise(e=>{if(!this.hitDetectionImageData_&&!this.animatingOrInteracting_){const i=[this.context.canvas.width,this.context.canvas.height];gt(this.pixelTransform,i);const s=this.renderedCenter_,n=this.renderedResolution_,o=this.renderedRotation_,r=this.renderedProjection_,a=this.wrappedRenderedExtent_,h=this.getLayer(),c=[],u=i[0]*U,d=i[1]*U;c.push(this.getRenderTransform(s,n,o,U,u,d,0).slice());const f=h.getSource(),g=r.getExtent();if(f.getWrapX()&&r.canWrapX()&&!vt(g,a)){let _=a[0];const x=Gt(g);let p=0,y;for(;_<g[0];)--p,y=x*p,c.push(this.getRenderTransform(s,n,o,U,u,d,y).slice()),_+=x;for(p=0,_=a[2];_>g[2];)++p,y=x*p,c.push(this.getRenderTransform(s,n,o,U,u,d,y).slice()),_-=x}this.hitDetectionImageData_=fn(i,c,this.renderedFeatures_,h.getStyleFunction(),a,n,o)}e(gn(t,this.renderedFeatures_,this.hitDetectionImageData_))})}forEachFeatureAtCoordinate(t,e,i,s,n){if(!this.replayGroup_)return;const o=e.viewState.resolution,r=e.viewState.rotation,a=this.getLayer(),h={},c=function(f,g,_){const x=It(f),p=h[x];if(p){if(p!==!0&&_<p.distanceSq){if(_===0)return h[x]=!0,n.splice(n.lastIndexOf(p),1),s(f,a,g);p.geometry=g,p.distanceSq=_}}else{if(_===0)return h[x]=!0,s(f,a,g);n.push(h[x]={feature:f,layer:a,geometry:g,distanceSq:_,callback:s})}};let u;const d=[this.replayGroup_];return this.declutterExecutorGroup&&d.push(this.declutterExecutorGroup),d.some(f=>u=f.forEachFeatureAtCoordinate(t,o,r,i,c,f===this.declutterExecutorGroup&&e.declutterTree?e.declutterTree.all().map(g=>g.value):null)),u}handleFontsChanged(){const t=this.getLayer();t.getVisible()&&this.replayGroup_&&t.changed()}handleStyleImageChange_(t){this.renderIfReadyAndVisible()}prepareFrame(t){const e=this.getLayer(),i=e.getSource();if(!i)return!1;const s=t.viewHints[Dt.ANIMATING],n=t.viewHints[Dt.INTERACTING],o=e.getUpdateWhileAnimating(),r=e.getUpdateWhileInteracting();if(this.ready&&!o&&s||!r&&n)return this.animatingOrInteracting_=!0,!0;this.animatingOrInteracting_=!1;const a=t.extent,h=t.viewState,c=h.projection,u=h.resolution,d=t.pixelRatio,f=e.getRevision(),g=e.getRenderBuffer();let _=e.getRenderOrder();_===void 0&&(_=pn);const x=h.center.slice(),p=ke(a,g*u),y=p.slice(),S=[p.slice()],C=c.getExtent();if(i.getWrapX()&&c.canWrapX()&&!vt(C,t.extent)){const R=Gt(C),L=Math.max(Gt(p)/2,R);p[0]=C[0]-L,p[2]=C[2]+L,$i(x,c);const T=Qi(S[0],c);T[0]<C[0]&&T[2]<C[2]?S.push([T[0]+R,T[1],T[2]+R,T[3]]):T[0]>C[0]&&T[2]>C[2]&&S.push([T[0]-R,T[1],T[2]-R,T[3]])}if(this.ready&&this.renderedResolution_==u&&this.renderedRevision_==f&&this.renderedRenderOrder_==_&&vt(this.wrappedRenderedExtent_,p))return Qt(this.renderedExtent_,y)||(this.hitDetectionImageData_=null,this.renderedExtent_=y),this.renderedCenter_=x,this.replayGroupChanged=!1,!0;this.replayGroup_=null;const w=new Qe(Se(u,d),p,u,d);let E;this.getLayer().getDeclutter()&&(E=new Qe(Se(u,d),p,u,d));const F=is();let k;if(F){for(let R=0,L=S.length;R<L;++R){const T=S[R],G=Ue(T,c);i.loadFeatures(G,ts(u,c),F)}k=es(F,c)}else for(let R=0,L=S.length;R<L;++R)i.loadFeatures(S[R],u,c);const O=xn(u,d);let M=!0;const v=R=>{let L;const T=R.getStyleFunction()||e.getStyleFunction();if(T&&(L=T(R,u)),L){const G=this.renderFeature(R,O,L,w,k,E);M=M&&!G}},D=Ue(p,c),b=i.getFeaturesInExtent(D);_&&b.sort(_);for(let R=0,L=b.length;R<L;++R)v(b[R]);this.renderedFeatures_=b,this.ready=M;const Y=w.finish(),P=new ii(p,u,d,i.getOverlaps(),Y,e.getRenderBuffer());return E&&(this.declutterExecutorGroup=new ii(p,u,d,i.getOverlaps(),E.finish(),e.getRenderBuffer())),this.renderedResolution_=u,this.renderedRevision_=f,this.renderedRenderOrder_=_,this.renderedExtent_=y,this.wrappedRenderedExtent_=p,this.renderedCenter_=x,this.renderedProjection_=c,this.replayGroup_=P,this.hitDetectionImageData_=null,this.replayGroupChanged=!0,!0}renderFeature(t,e,i,s,n,o){if(!i)return!1;let r=!1;if(Array.isArray(i))for(let a=0,h=i.length;a<h;++a)r=si(s,t,i[a],e,this.boundHandleStyleImageChange_,n,o)||r;else r=si(s,t,i,e,this.boundHandleStyleImageChange_,n,o);return r}}const Ln=En;class Fn extends ss{constructor(t){super(t)}createRenderer(){return new Ln(this)}}const On=Fn;class Ut extends ns{constructor(t){super(),this.geometries_=t||null,this.changeEventsKeys_=[],this.listenGeometriesChange_()}unlistenGeometriesChange_(){this.changeEventsKeys_.forEach(os),this.changeEventsKeys_.length=0}listenGeometriesChange_(){if(this.geometries_)for(let t=0,e=this.geometries_.length;t<e;++t)this.changeEventsKeys_.push(rs(this.geometries_[t],as.CHANGE,this.changed,this))}clone(){const t=new Ut(null);return t.setGeometries(this.geometries_),t.applyProperties(this),t}closestPointXY(t,e,i,s){if(s<kt(this.getExtent(),t,e))return s;const n=this.geometries_;for(let o=0,r=n.length;o<r;++o)s=n[o].closestPointXY(t,e,i,s);return s}containsXY(t,e){const i=this.geometries_;for(let s=0,n=i.length;s<n;++s)if(i[s].containsXY(t,e))return!0;return!1}computeExtent(t){ls(t);const e=this.geometries_;for(let i=0,s=e.length;i<s;++i)hs(t,e[i].getExtent());return t}getGeometries(){return ni(this.geometries_)}getGeometriesArray(){return this.geometries_}getGeometriesArrayRecursive(){let t=[];const e=this.geometries_;for(let i=0,s=e.length;i<s;++i)e[i].getType()===this.getType()?t=t.concat(e[i].getGeometriesArrayRecursive()):t.push(e[i]);return t}getSimplifiedGeometry(t){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),t<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&t<this.simplifiedGeometryMaxMinSquaredTolerance)return this;const e=[],i=this.geometries_;let s=!1;for(let n=0,o=i.length;n<o;++n){const r=i[n],a=r.getSimplifiedGeometry(t);e.push(a),a!==r&&(s=!0)}if(s){const n=new Ut(null);return n.setGeometriesArray(e),n}return this.simplifiedGeometryMaxMinSquaredTolerance=t,this}getType(){return"GeometryCollection"}intersectsExtent(t){const e=this.geometries_;for(let i=0,s=e.length;i<s;++i)if(e[i].intersectsExtent(t))return!0;return!1}isEmpty(){return this.geometries_.length===0}rotate(t,e){const i=this.geometries_;for(let s=0,n=i.length;s<n;++s)i[s].rotate(t,e);this.changed()}scale(t,e,i){i||(i=cs(this.getExtent()));const s=this.geometries_;for(let n=0,o=s.length;n<o;++n)s[n].scale(t,e,i);this.changed()}setGeometries(t){this.setGeometriesArray(ni(t))}setGeometriesArray(t){this.unlistenGeometriesChange_(),this.geometries_=t,this.listenGeometriesChange_(),this.changed()}applyTransform(t){const e=this.geometries_;for(let i=0,s=e.length;i<s;++i)e[i].applyTransform(t);this.changed()}translate(t,e){const i=this.geometries_;for(let s=0,n=i.length;s<n;++s)i[s].translate(t,e);this.changed()}disposeInternal(){this.unlistenGeometriesChange_(),super.disposeInternal()}}function ni(l){const t=[];for(let e=0,i=l.length;e<i;++e)t.push(l[e].clone());return t}const Mn=Ut;class bn{constructor(){this.dataProjection=void 0,this.defaultFeatureProjection=void 0,this.supportedMediaTypes=null}getReadOptions(t,e){if(e){let i=e.dataProjection?rt(e.dataProjection):this.readProjection(t);e.extent&&i&&i.getUnits()==="tile-pixels"&&(i=rt(i),i.setWorldExtent(e.extent)),e={dataProjection:i,featureProjection:e.featureProjection}}return this.adaptOptions(e)}adaptOptions(t){return Object.assign({dataProjection:this.dataProjection,featureProjection:this.defaultFeatureProjection},t)}getType(){return W()}readFeature(t,e){return W()}readFeatures(t,e){return W()}readGeometry(t,e){return W()}readProjection(t){return W()}writeFeature(t,e){return W()}writeFeatures(t,e){return W()}writeGeometry(t,e){return W()}}function gi(l,t,e){const i=e?rt(e.featureProjection):null,s=e?rt(e.dataProjection):null;let n;if(i&&s&&!ds(i,s)?n=(t?l.clone():l).transform(t?i:s,t?s:i):n=l,t&&e&&e.decimals!==void 0){const o=Math.pow(10,e.decimals),r=function(a){for(let h=0,c=a.length;h<c;++h)a[h]=Math.round(a[h]*o)/o;return a};n===l&&(n=l.clone()),n.applyTransform(r)}return n}class Pn extends bn{constructor(){super()}getType(){return"json"}readFeature(t,e){return this.readFeatureFromObject(Wt(t),this.getReadOptions(t,e))}readFeatures(t,e){return this.readFeaturesFromObject(Wt(t),this.getReadOptions(t,e))}readFeatureFromObject(t,e){return W()}readFeaturesFromObject(t,e){return W()}readGeometry(t,e){return this.readGeometryFromObject(Wt(t),this.getReadOptions(t,e))}readGeometryFromObject(t,e){return W()}readProjection(t){return this.readProjectionFromObject(Wt(t))}readProjectionFromObject(t){return W()}writeFeature(t,e){return JSON.stringify(this.writeFeatureObject(t,e))}writeFeatureObject(t,e){return W()}writeFeatures(t,e){return JSON.stringify(this.writeFeaturesObject(t,e))}writeFeaturesObject(t,e){return W()}writeGeometry(t,e){return JSON.stringify(this.writeGeometryObject(t,e))}writeGeometryObject(t,e){return W()}}function Wt(l){if(typeof l=="string"){const t=JSON.parse(l);return t||null}return l!==null?l:null}const Dn=Pn;function _i(l,t,e,i,s,n,o){let r,a;const h=(e-t)/i;if(h===1)r=t;else if(h===2)r=t,a=s;else if(h!==0){let c=l[t],u=l[t+1],d=0;const f=[0];for(let x=t+i;x<e;x+=i){const p=l[x],y=l[x+1];d+=Math.sqrt((p-c)*(p-c)+(y-u)*(y-u)),f.push(d),c=p,u=y}const g=s*d,_=us(f,g);_<0?(a=(g-f[-_-2])/(f[-_-1]-f[-_-2]),r=t+(-_-2)*i):r=t+_*i}o=o>1?o:2,n=n||new Array(o);for(let c=0;c<o;++c)n[c]=r===void 0?NaN:a===void 0?l[r+c]:V(l[r+c],l[r+i+c],a);return n}function Ce(l,t,e,i,s,n){if(e==t)return null;let o;if(s<l[t+i-1])return n?(o=l.slice(t,t+i),o[i-1]=s,o):null;if(l[e-1]<s)return n?(o=l.slice(e-i,e),o[i-1]=s,o):null;if(s==l[t+i-1])return l.slice(t,t+i);let r=t/i,a=e/i;for(;r<a;){const d=r+a>>1;s<l[(d+1)*i-1]?a=d:r=d+1}const h=l[r*i-1];if(s==h)return l.slice((r-1)*i,(r-1)*i+i);const c=l[(r+1)*i-1],u=(s-h)/(c-h);o=[];for(let d=0;d<i-1;++d)o.push(V(l[(r-1)*i+d],l[r*i+d],u));return o.push(s),o}function Gn(l,t,e,i,s,n,o){if(o)return Ce(l,t,e[e.length-1],i,s,n);let r;if(s<l[i-1])return n?(r=l.slice(0,i),r[i-1]=s,r):null;if(l[l.length-1]<s)return n?(r=l.slice(l.length-i),r[i-1]=s,r):null;for(let a=0,h=e.length;a<h;++a){const c=e[a];if(t!=c){if(s<l[t+i-1])return null;if(s<=l[c-1])return Ce(l,t,c,i,s,!1);t=c}}return null}class zt extends te{constructor(t,e){super(),this.flatMidpoint_=null,this.flatMidpointRevision_=-1,this.maxDelta_=-1,this.maxDeltaRevision_=-1,e!==void 0&&!Array.isArray(t[0])?this.setFlatCoordinates(e,t):this.setCoordinates(t,e)}appendCoordinate(t){this.flatCoordinates?ct(this.flatCoordinates,t):this.flatCoordinates=t.slice(),this.changed()}clone(){const t=new zt(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,e,i,s){return s<kt(this.getExtent(),t,e)?s:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(fs(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),gs(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!1,t,e,i,s))}forEachSegment(t){return _s(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}getCoordinateAtM(t,e){return this.layout!="XYM"&&this.layout!="XYZM"?null:(e=e!==void 0?e:!1,Ce(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e))}getCoordinates(){return _t(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinateAt(t,e){return _i(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,this.stride)}getLength(){return di(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getFlatMidpoint(){return this.flatMidpointRevision_!=this.getRevision()&&(this.flatMidpoint_=this.getCoordinateAt(.5,this.flatMidpoint_),this.flatMidpointRevision_=this.getRevision()),this.flatMidpoint_}getSimplifiedGeometryInternal(t){const e=[];return e.length=ps(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,0),new zt(e,"XY")}getType(){return"LineString"}intersectsExtent(t){return xs(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=ai(this.flatCoordinates,0,t,this.stride),this.changed()}}const we=zt;class qt extends te{constructor(t,e,i){if(super(),this.ends_=[],this.maxDelta_=-1,this.maxDeltaRevision_=-1,Array.isArray(t[0]))this.setCoordinates(t,e);else if(e!==void 0&&i)this.setFlatCoordinates(e,t),this.ends_=i;else{let s=this.getLayout();const n=t,o=[],r=[];for(let a=0,h=n.length;a<h;++a){const c=n[a];a===0&&(s=c.getLayout()),ct(o,c.getFlatCoordinates()),r.push(o.length)}this.setFlatCoordinates(s,o),this.ends_=r}}appendLineString(t){this.flatCoordinates?ct(this.flatCoordinates,t.getFlatCoordinates().slice()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const t=new qt(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return t.applyProperties(this),t}closestPointXY(t,e,i,s){return s<kt(this.getExtent(),t,e)?s:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(ms(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),ys(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!1,t,e,i,s))}getCoordinateAtM(t,e,i){return this.layout!="XYM"&&this.layout!="XYZM"||this.flatCoordinates.length===0?null:(e=e!==void 0?e:!1,i=i!==void 0?i:!1,Gn(this.flatCoordinates,0,this.ends_,this.stride,t,e,i))}getCoordinates(){return _e(this.flatCoordinates,0,this.ends_,this.stride)}getEnds(){return this.ends_}getLineString(t){return t<0||this.ends_.length<=t?null:new we(this.flatCoordinates.slice(t===0?0:this.ends_[t-1],this.ends_[t]),this.layout)}getLineStrings(){const t=this.flatCoordinates,e=this.ends_,i=this.layout,s=[];let n=0;for(let o=0,r=e.length;o<r;++o){const a=e[o],h=new we(t.slice(n,a),i);s.push(h),n=a}return s}getFlatMidpoints(){const t=[],e=this.flatCoordinates;let i=0;const s=this.ends_,n=this.stride;for(let o=0,r=s.length;o<r;++o){const a=s[o],h=_i(e,i,a,n,.5);ct(t,h),i=a}return t}getSimplifiedGeometryInternal(t){const e=[],i=[];return e.length=Ss(this.flatCoordinates,0,this.ends_,this.stride,t,e,0,i),new qt(e,"XY",i)}getType(){return"MultiLineString"}intersectsExtent(t){return Cs(this.flatCoordinates,0,this.ends_,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,2),this.flatCoordinates||(this.flatCoordinates=[]);const i=ws(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=i.length===0?0:i[i.length-1],this.changed()}}const vn=qt;class Le extends te{constructor(t,e){super(),e&&!Array.isArray(t[0])?this.setFlatCoordinates(e,t):this.setCoordinates(t,e)}appendPoint(t){this.flatCoordinates?ct(this.flatCoordinates,t.getFlatCoordinates()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.changed()}clone(){const t=new Le(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,e,i,s){if(s<kt(this.getExtent(),t,e))return s;const n=this.flatCoordinates,o=this.stride;for(let r=0,a=n.length;r<a;r+=o){const h=Rs(t,e,n[r],n[r+1]);if(h<s){s=h;for(let c=0;c<o;++c)i[c]=n[r+c];i.length=o}}return s}getCoordinates(){return _t(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getPoint(t){const e=this.flatCoordinates?this.flatCoordinates.length/this.stride:0;return t<0||e<=t?null:new me(this.flatCoordinates.slice(t*this.stride,(t+1)*this.stride),this.layout)}getPoints(){const t=this.flatCoordinates,e=this.layout,i=this.stride,s=[];for(let n=0,o=t.length;n<o;n+=i){const r=new me(t.slice(n,n+i),e);s.push(r)}return s}getType(){return"MultiPoint"}intersectsExtent(t){const e=this.flatCoordinates,i=this.stride;for(let s=0,n=e.length;s<n;s+=i){const o=e[s],r=e[s+1];if(Is(t,o,r))return!0}return!1}setCoordinates(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=ai(this.flatCoordinates,0,t,this.stride),this.changed()}}const pi=Le;function An(l,t,e,i){const s=[];let n=Tt();for(let o=0,r=e.length;o<r;++o){const a=e[o];n=Ts(l,t,a[0],i),s.push((n[0]+n[2])/2,(n[1]+n[3])/2),t=a[a.length-1]}return s}class $t extends te{constructor(t,e,i){if(super(),this.endss_=[],this.flatInteriorPointsRevision_=-1,this.flatInteriorPoints_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,!i&&!Array.isArray(t[0])){let s=this.getLayout();const n=t,o=[],r=[];for(let a=0,h=n.length;a<h;++a){const c=n[a];a===0&&(s=c.getLayout());const u=o.length,d=c.getEnds();for(let f=0,g=d.length;f<g;++f)d[f]+=u;ct(o,c.getFlatCoordinates()),r.push(d)}e=s,t=o,i=r}e!==void 0&&i?(this.setFlatCoordinates(e,t),this.endss_=i):this.setCoordinates(t,e)}appendPolygon(t){let e;if(!this.flatCoordinates)this.flatCoordinates=t.getFlatCoordinates().slice(),e=t.getEnds().slice(),this.endss_.push();else{const i=this.flatCoordinates.length;ct(this.flatCoordinates,t.getFlatCoordinates()),e=t.getEnds().slice();for(let s=0,n=e.length;s<n;++s)e[s]+=i}this.endss_.push(e),this.changed()}clone(){const t=this.endss_.length,e=new Array(t);for(let s=0;s<t;++s)e[s]=this.endss_[s].slice();const i=new $t(this.flatCoordinates.slice(),this.layout,e);return i.applyProperties(this),i}closestPointXY(t,e,i,s){return s<kt(this.getExtent(),t,e)?s:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(ks(this.flatCoordinates,0,this.endss_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Es(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,this.maxDelta_,!0,t,e,i,s))}containsXY(t,e){return Ls(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t,e)}getArea(){return Fs(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride)}getCoordinates(t){let e;return t!==void 0?(e=this.getOrientedFlatCoordinates().slice(),ze(e,0,this.endss_,this.stride,t)):e=this.flatCoordinates,pe(e,0,this.endss_,this.stride)}getEndss(){return this.endss_}getFlatInteriorPoints(){if(this.flatInteriorPointsRevision_!=this.getRevision()){const t=An(this.flatCoordinates,0,this.endss_,this.stride);this.flatInteriorPoints_=Os(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t),this.flatInteriorPointsRevision_=this.getRevision()}return this.flatInteriorPoints_}getInteriorPoints(){return new pi(this.getFlatInteriorPoints().slice(),"XYM")}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const t=this.flatCoordinates;Ms(t,0,this.endss_,this.stride)?this.orientedFlatCoordinates_=t:(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=ze(this.orientedFlatCoordinates_,0,this.endss_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(t){const e=[],i=[];return e.length=bs(this.flatCoordinates,0,this.endss_,this.stride,Math.sqrt(t),e,0,i),new $t(e,"XY",i)}getPolygon(t){if(t<0||this.endss_.length<=t)return null;let e;if(t===0)e=0;else{const n=this.endss_[t-1];e=n[n.length-1]}const i=this.endss_[t].slice(),s=i[i.length-1];if(e!==0)for(let n=0,o=i.length;n<o;++n)i[n]-=e;return new ye(this.flatCoordinates.slice(e,s),this.layout,i)}getPolygons(){const t=this.layout,e=this.flatCoordinates,i=this.endss_,s=[];let n=0;for(let o=0,r=i.length;o<r;++o){const a=i[o].slice(),h=a[a.length-1];if(n!==0)for(let u=0,d=a.length;u<d;++u)a[u]-=n;const c=new ye(e.slice(n,h),t,a);s.push(c),n=h}return s}getType(){return"MultiPolygon"}intersectsExtent(t){return Ps(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,3),this.flatCoordinates||(this.flatCoordinates=[]);const i=Ds(this.flatCoordinates,0,t,this.stride,this.endss_);if(i.length===0)this.flatCoordinates.length=0;else{const s=i[i.length-1];this.flatCoordinates.length=s.length===0?0:s[s.length-1]}this.changed()}}const Wn=$t;class Bn extends Dn{constructor(t){t=t||{},super(),this.dataProjection=rt(t.dataProjection?t.dataProjection:"EPSG:4326"),t.featureProjection&&(this.defaultFeatureProjection=rt(t.featureProjection)),this.geometryName_=t.geometryName,this.extractGeometryName_=t.extractGeometryName,this.supportedMediaTypes=["application/geo+json","application/vnd.geo+json"]}readFeatureFromObject(t,e){let i=null;t.type==="Feature"?i=t:i={type:"Feature",geometry:t,properties:null};const s=Re(i.geometry,e),n=new Gs;return this.geometryName_?n.setGeometryName(this.geometryName_):this.extractGeometryName_&&"geometry_name"in i!==void 0&&n.setGeometryName(i.geometry_name),n.setGeometry(s),"id"in i&&n.setId(i.id),i.properties&&n.setProperties(i.properties,!0),n}readFeaturesFromObject(t,e){const i=t;let s=null;if(i.type==="FeatureCollection"){const n=t;s=[];const o=n.features;for(let r=0,a=o.length;r<a;++r)s.push(this.readFeatureFromObject(o[r],e))}else s=[this.readFeatureFromObject(t,e)];return s}readGeometryFromObject(t,e){return Re(t,e)}readProjectionFromObject(t){const e=t.crs;let i;if(e)if(e.type=="name")i=rt(e.properties.name);else if(e.type==="EPSG")i=rt("EPSG:"+e.properties.code);else throw new Error("Unknown SRS type");else i=this.dataProjection;return i}writeFeatureObject(t,e){e=this.adaptOptions(e);const i={type:"Feature",geometry:null,properties:null},s=t.getId();if(s!==void 0&&(i.id=s),!t.hasProperties())return i;const n=t.getProperties(),o=t.getGeometry();return o&&(i.geometry=Ie(o,e),delete n[t.getGeometryName()]),ri(n)||(i.properties=n),i}writeFeaturesObject(t,e){e=this.adaptOptions(e);const i=[];for(let s=0,n=t.length;s<n;++s)i.push(this.writeFeatureObject(t[s],e));return{type:"FeatureCollection",features:i}}writeGeometryObject(t,e){return Ie(t,this.adaptOptions(e))}}function Re(l,t){if(!l)return null;let e;switch(l.type){case"Point":{e=jn(l);break}case"LineString":{e=Nn(l);break}case"Polygon":{e=Vn(l);break}case"MultiPoint":{e=Jn(l);break}case"MultiLineString":{e=Xn(l);break}case"MultiPolygon":{e=Hn(l);break}case"GeometryCollection":{e=Yn(l);break}default:throw new Error("Unsupported GeoJSON type: "+l.type)}return gi(e,!1,t)}function Yn(l,t){const e=l.geometries.map(function(i){return Re(i,t)});return new Mn(e)}function jn(l){return new me(l.coordinates)}function Nn(l){return new we(l.coordinates)}function Xn(l){return new vn(l.coordinates)}function Jn(l){return new pi(l.coordinates)}function Hn(l){return new Wn(l.coordinates)}function Vn(l){return new ye(l.coordinates)}function Ie(l,t){l=gi(l,!0,t);const e=l.getType();let i;switch(e){case"Point":{i=$n(l);break}case"LineString":{i=Kn(l);break}case"Polygon":{i=Qn(l,t);break}case"MultiPoint":{i=zn(l);break}case"MultiLineString":{i=Un(l);break}case"MultiPolygon":{i=qn(l,t);break}case"GeometryCollection":{i=Zn(l,t);break}case"Circle":{i={type:"GeometryCollection",geometries:[]};break}default:throw new Error("Unsupported geometry type: "+e)}return i}function Zn(l,t){return t=Object.assign({},t),delete t.featureProjection,{type:"GeometryCollection",geometries:l.getGeometriesArray().map(function(i){return Ie(i,t)})}}function Kn(l,t){return{type:"LineString",coordinates:l.getCoordinates()}}function Un(l,t){return{type:"MultiLineString",coordinates:l.getCoordinates()}}function zn(l,t){return{type:"MultiPoint",coordinates:l.getCoordinates()}}function qn(l,t){let e;return t&&(e=t.rightHanded),{type:"MultiPolygon",coordinates:l.getCoordinates(e)}}function $n(l,t){return{type:"Point",coordinates:l.getCoordinates()}}function Qn(l,t){let e;return t&&(e=t.rightHanded),{type:"Polygon",coordinates:l.getCoordinates(e)}}const to=Bn;li.registerLanguage("json",vs);const eo=new ee({color:"#843ac5"}),io=new ee({color:"rgba(255,30,30,0.5)"}),so=new ee({color:"rgba(255,165,30,0.5)"}),no=new ie({color:"rgba(255,255,255, 0.4)",width:1}),oo=new ie({color:"rgb(255,30,30)",width:2}),ro=new ie({color:"rgb(255, 165, 30)",width:2});let ao=new se({image:new hi({fill:eo,stroke:no,radius:3})}),lo=new se({image:new hi({fill:io,stroke:oo,radius:6}),zIndex:1}),ho=new se({image:new As({fill:so,stroke:ro,points:5,radius1:5,radius2:12,rotation:Math.PI/5}),zIndex:2}),ge=new se({text:new Ws({offsetY:13,fill:new ee({color:"#000"}),stroke:new ie({color:"rgba(255, 255, 255, 0.7)",width:4})}),zIndex:3});const co=5e5,uo=1e6,fo=1e3,go="10px Calibri,sans-serif",_o="bold 13px Calibri,sans-serif",po=(l,t)=>{const{pop:e,name:i}=l.getProperties();let s=ge.getText();if(e<co){if(t<fo)return ao}else return e<uo?(s.setFont(go),s.setText(i),[lo,ge]):(s.setFont(_o),s.setText(i),[ho,ge])},xi=new On({source:new Bs({url:"/data/germany.geojson",format:new to,attributions:'<a href="https://github.com/pensnarik/german-cities">Cities of Germany</a>'}),style:po});Ys();const mi=new js({layers:[new Ns({source:new Xs,opacity:.33}),xi],target:"map",view:new Js({center:[8.8,51.3],zoom:5})}),Bt=document.getElementById("map-description"),xo=document.getElementById("raw-description"),Te=document.getElementById("speak"),Fe=async()=>{const l=await Hs(mi,{viewDescriber:()=>{}}),t=li.highlight(JSON.stringify(l,void 0,"  "),{language:"json"}).value;Bt.innerHTML=l.text,xo.innerHTML=t,Te.disabled=l.text===""};mi.on("moveend",Fe);xi.on("change",Fe);Fe();Te&&Te.addEventListener("click",()=>{const l=Bt==null?void 0:Bt.innerHTML;if(l){var t=new SpeechSynthesisUtterance;t.text=l,window.speechSynthesis.speak(t)}});
